<!DOCTYPE html>
<html lang="pt-BR" class="">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laissez Faire - Acesso Centralizado</title>
    
    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* Estilo base com a fonte Inter e Helvetica como fallback */
        body {
            font-family: 'Inter', 'Helvetica', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        /* Transições suaves para modo escuro/claro */
        .transition-all-fast {
            transition: all 0.2s ease-in-out;
        }
        /* Esconde a barra de rolagem do iframe */
        iframe::-webkit-scrollbar { display: none; }
        iframe { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Estilos do Skeleton Preloader */
        .skeleton-box {
            background-color: #e5e7eb; /* gray-200 */
            border-radius: 0.5rem; /* rounded-lg */
            animation: skeleton-shimmer 1.5s infinite linear;
            background-image: linear-gradient(90deg, #e5e7eb 0px, #f3f4f6 40px, #e5e7eb 80px);
            background-size: 600px;
        }
        .dark .skeleton-box {
            background-color: #374151; /* dark:gray-700 */
            background-image: linear-gradient(90deg, #374151 0px, #4b5563 40px, #374151 80px);
        }
        @keyframes skeleton-shimmer {
            0% { background-position: -300px; }
            100% { background-position: 300px; }
        }
    </style>
    <!-- Pixel Code - https://amplify.insigne.solutions/ -->
    <script src="https://amplify.insigne.solutions/pixel/tqYCJ0HQeKGg0y5m"></script>
    <!-- END Pixel Code -->
    <script>
        // Configuração do Tailwind para modo escuro e nova cor
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'brand-slate-gray': '#34495E',
                        'brand-dark-blue': '#1C3F53',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-gray-200 transition-all-fast">

    <!-- =================================================================== -->
    <!-- TELA DO DASHBOARD -->
    <!-- =================================================================== -->
    <div id="dashboard-screen" class="flex flex-col min-h-screen hidden"> <!-- Inicia oculto para evitar piscar -->
        <header class="bg-white dark:bg-gray-800 shadow-sm sticky top-0 z-20">
            <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
                <div class="flex h-12 items-center justify-between">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <img class="h-8 w-auto" src="logo.png" alt="Laissez Faire Consulting Logo" onerror="this.onerror=null;this.src='https://placehold.co/100x32/1C3F53/FFFFFF?text=Logo';">
                        </div>
                        <span class="ml-3 font-bold text-lg text-gray-800 dark:text-white">Laissez Faire</span>
                    </div>
                    <div class="flex items-center space-x-4">
                        <a href="https://laissezfaire.consulting" target="_blank" class="flex items-center space-x-2 text-sm font-normal text-gray-600 dark:text-gray-300 hover:text-brand-dark-blue dark:hover:text-brand-cyan transition-all-fast p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700" title="Visualizar site">
                            <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M10 6H6a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-4M14 4h6m0 0v6m0-6L10 14" /></svg>
                            <span>Visualizar site</span>
                        </a>
                        <div class="flex items-center space-x-1 relative">
                            <button id="fullscreen-toggle" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-all-fast" title="Alternar tela cheia">
                                <svg id="expand-icon" class="h-6 w-6 text-gray-500 dark:text-gray-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"> <path stroke-linecap="round" stroke-linejoin="round" d="M4 8V4h4M20 8V4h-4M4 16v4h4M20 16v4h-4" /> </svg>
                                <svg id="compress-icon" class="hidden h-6 w-6 text-gray-500 dark:text-gray-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 9V4.5M9 9H4.5M9 9 3.75 3.75M9 15v4.5M9 15H4.5M9 15l-5.25 5.25M15 9V4.5M15 9h4.5M15 9l5.25-5.25M15 15v4.5M15 15h4.5M15 15l5.25 5.25" /></svg>
                            </button>
                            <div class="relative">
                                <button id="settings-button" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-all-fast" title="Configurações">
                                    <svg class="h-6 w-6 text-gray-500 dark:text-gray-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.242 1.434l-1.005.827c-.293.24-.438.613-.438.995s.145.755.438.995l1.005.827a1.125 1.125 0 0 1 .242 1.434l-1.296 2.247a1.125 1.125 0 0 1-1.37.49l-1.217-.456c-.355-.133-.75-.072-1.075.124a6.57 6.57 0 0 1-.22.128c-.332.183-.582.495-.645.87l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.063-.374-.313-.686-.645-.87a6.52 6.52 0 0 1-.22-.127c-.324-.196-.72-.257-1.075-.124l-1.217.456a1.125 1.125 0 0 1-1.37-.49l-1.296-2.247a1.125 1.125 0 0 1 .242-1.434l1.005-.827c.293-.24.438.613.438.995s-.145-.755-.438-.995l-1.005-.827a1.125 1.125 0 0 1-.242-1.434l1.296-2.247a1.125 1.125 0 0 1 1.37-.49l1.217.456c.355.133.75.072 1.075-.124.073-.044.146-.087.22-.128.332-.183.582-.495.645-.87l.213-1.281Z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" /></svg>
                                </button>
                                <div id="settings-dropdown" class="hidden absolute right-0 mt-2 w-56 origin-top-right bg-white dark:bg-gray-700 rounded-md shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none">
                                    <div class="py-1">
                                        <a href="#pdf" class="flex items-center px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600">
                                            <svg class="h-5 w-5 mr-3 text-gray-500 dark:text-gray-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m.75 12 3 3m0 0 3-3m-3 3v-6m-1.5-9H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z" /></svg>
                                            <span>Relatorio em PDF</span>
                                        </a>
                                        <a href="http://audit.insigne.solutions/audit/lfc" target="_blank" class="flex items-center px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600">
                                            <svg class="h-5 w-5 mr-3 text-gray-500 dark:text-gray-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75m-3-7.036A11.959 11.959 0 0 1 3.598 6 11.99 11.99 0 0 0 3 9.749c0 5.592 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.6-3.751A11.959 11.959 0 0 1 12 2.764Z" /></svg>
                                            <span>Auditoria</span>
                                        </a>
                                        <a href="https://status.insigne.company" target="_blank" class="flex items-center px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600">
                                            <svg class="h-5 w-5 mr-3 text-gray-500 dark:text-gray-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 12h3l2.25-6L12 18l2.25-6 3 6h3" /></svg>
                                            <span>Status</span>
                                        </a>
                                        <a href="#" class="flex items-center px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600">
                                            <svg class="h-5 w-5 mr-3 text-gray-500 dark:text-gray-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 5.25h.008v.008H12v-.008Z" /></svg>
                                            <span>Suporte</span>
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <button id="dark-mode-toggle" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-all-fast">
                                <svg id="sun-icon" class="h-6 w-6 text-yellow-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.5 12a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM18.894 6.106a.75.75 0 010 1.06l-1.591 1.592a.75.75 0 01-1.06-1.061l1.59-1.591a.75.75 0 011.06 0zM21.75 12a.75.75 0 01-.75.75h-2.25a.75.75 0 010-1.5h2.25a.75.75 0 01.75.75zM17.836 17.836a.75.75 0 01-1.06 0l-1.59-1.591a.75.75 0 111.06-1.06l1.591 1.59a.75.75 0 010 1.061zM12 21.75a.75.75 0 01-.75-.75v-2.25a.75.75 0 011.5 0v2.25a.75.75 0 01-.75.75zM5.106 18.894a.75.75 0 010-1.06l1.591-1.592a.75.75 0 011.06 1.061l-1.59 1.591a.75.75 0 01-1.06 0zM3 12a.75.75 0 01.75-.75h2.25a.75.75 0 010 1.5H3.75A.75.75 0 013 12zM6.106 5.106a.75.75 0 011.06 0l1.59 1.591a.75.75 0 01-1.06 1.06l-1.59-1.59a.75.75 0 010-1.061z" /></svg>
                                <svg id="moon-icon" class="h-6 w-6 text-slate-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z" /></svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <main class="flex-grow mx-auto max-w-7xl w-full px-4 sm:px-6 lg:px-8 py-4">
            <div class="text-center mb-6">
                <h1 id="welcome-header" class="text-xl sm:text-2xl font-bold text-gray-900 dark:text-white">Carregando...</h1>
                <p class="mt-1 text-sm text-gray-600 dark:text-gray-400 max-w-3xl mx-auto">Ajuste preferências do seu site, visualize dados em tempo real, ative campanhas e conecte CRMs e redes com facilidade.</p>
                <p class="mt-1 text-xs text-gray-500 dark:text-gray-500">Você está usando a versão 2.7.1 deste app. Seu banco de dados está sincronizado com as últimas alterações.</p>
            </div>
            
            <h2 class="text-lg font-bold mb-3 text-gray-800 dark:text-gray-200">Aplicações Insigne</h2>
            <div id="insigne-app-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4">
                <!-- Cards das aplicações Insigne serão inseridos aqui -->
            </div>

            <h2 class="text-lg font-bold mt-4 mb-3 text-gray-800 dark:text-gray-200">Ferramentas Externas</h2>
            <div id="external-app-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3">
                <!-- Cards das ferramentas externas serão inseridos aqui -->
            </div>
        </main>
        
        <footer class="w-full">
            <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-3 border-t border-gray-200 dark:border-gray-700">
                <div class="grid grid-cols-1 sm:grid-cols-3 items-center text-sm text-gray-500 dark:text-gray-400 space-y-2 sm:space-y-0">
                    <p class="text-center sm:text-left">Powered by <span class="font-bold text-gray-700 dark:text-gray-300">Insigne Company</span></p>
                    <div class="flex justify-center space-x-4">
                        <a href="#" class="hover:text-brand-dark-blue">MediaKit</a>
                        <a href="http://audit.insigne.solutions/audit/lfc" target="_blank" class="hover:text-brand-dark-blue">Auditoria</a>
                        <a href="#" class="hover:text-brand-dark-blue">Contrato</a>
                        <a href="https://status.insigne.company" target="_blank" class="hover:text-brand-dark-blue">Status</a>
                    </div>
                    <p id="footer-year" class="text-center sm:text-right">© 2025 Laissez Faire. Todos os direitos reservados.</p>
                </div>
            </div>
        </footer>
    </div>

    <!-- =================================================================== -->
    <!-- TELA DE VISUALIZAÇÃO DO APP (IFRAME) -->
    <!-- =================================================================== -->
    <div id="app-view-screen" class="hidden h-screen w-screen flex fixed top-0 left-0">
        <div class="flex-grow h-full relative bg-gray-50 dark:bg-gray-900">
            <!-- Skeleton Loader for App Content -->
            <div id="app-content-loader" class="hidden w-full h-full p-6 sm:p-8">
                <div class="space-y-6">
                    <div class="skeleton-box h-16 w-1/3"></div>
                    <div class="space-y-4">
                        <div class="skeleton-box h-8 w-full"></div>
                        <div class="skeleton-box h-8 w-5/6"></div>
                    </div>
                    <div class="skeleton-box h-64 w-full"></div>
                    <div class="skeleton-box h-32 w-full"></div>
                </div>
            </div>
            <iframe id="app-iframe" src="" class="hidden w-full h-full border-none" title="Aplicação Integrada"></iframe>
        </div>
        <aside class="w-16 bg-gray-800 dark:bg-black/80 backdrop-blur-sm flex flex-col items-center justify-between py-5 shadow-2xl">
            <img class="h-8 w-auto" src="logo.png" alt="Logo" onerror="this.onerror=null;this.src='https://placehold.co/32x32/FFFFFF/1C3F53?text=LFC&font=sans-serif'; this.classList.add('rounded-full');">
            
            <button id="home-button" class="text-gray-300 hover:text-white transition-all-fast" title="Início">
                <svg class="h-8 w-8" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h7.5" /></svg>
            </button>
            
            <button id="logout-button" class="text-gray-300 hover:text-white transition-all-fast" title="Sair">
                <svg class="h-8 w-8" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25 2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15m3 0 3-3m0 0-3-3m3 3H9" /></svg>
            </button>
        </aside>
    </div>

    <!-- =================================================================== -->
    <!-- PRELOADER (Global, for dashboard transition) -->
    <!-- =================================================================== -->
    <div id="preloader" class="hidden fixed inset-0 bg-gray-50 dark:bg-gray-900 z-50 p-4 sm:p-8 transition-opacity duration-300 opacity-0">
        <div class="mx-auto max-w-7xl w-full">
            <div class="w-1/2 sm:w-1/3 h-8 skeleton-box mb-8 mx-auto"></div>
            <div class="h-4 w-3/4 skeleton-box mb-2 mx-auto"></div>
            <div class="h-3 w-1/2 skeleton-box mb-10 mx-auto"></div>
            
            <div class="h-6 w-1/4 skeleton-box mb-4"></div>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4 mb-8">
                <div class="h-40 skeleton-box"></div>
                <div class="h-40 skeleton-box"></div>
                <div class="h-40 skeleton-box"></div>
                <div class="h-40 skeleton-box"></div>
                <div class="h-40 skeleton-box"></div>
            </div>

            <div class="h-6 w-1/4 skeleton-box mb-4"></div>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3">
                <div class="h-20 skeleton-box"></div>
                <div class="h-20 skeleton-box"></div>
                <div class="h-20 skeleton-box"></div>
                <div class="h-20 skeleton-box"></div>
            </div>
        </div>
    </div>
    
    <!-- =================================================================== -->
    <!-- MODAL PARA LINKS EXTERNOS -->
    <!-- =================================================================== -->
    <div id="external-link-modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 z-50 flex items-center justify-center p-4 transition-opacity duration-300">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-md transform transition-all duration-300 scale-95">
            <h3 id="modal-title" class="text-lg font-bold text-gray-900 dark:text-white">Acesso Externo</h3>
            <p id="modal-text" class="mt-2 text-sm text-gray-600 dark:text-gray-400">Este aplicativo não pode ser aberto aqui por restrições de segurança. Ele será aberto em uma nova aba do seu navegador.</p>
            <div class="mt-6 flex justify-end space-x-4">
                <button id="modal-close-button" class="px-4 py-2 bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-200 rounded-md hover:bg-gray-300 dark:hover:bg-gray-500 transition-all-fast">Ok, entendi</button>
                <a id="modal-open-link" href="#" target="_blank" class="px-4 py-2 bg-brand-dark-blue text-white rounded-md hover:bg-brand-slate-gray transition-all-fast">Abrir em nova janela</a>
            </div>
        </div>
    </div>


    
    <script>
    document.addEventListener('DOMContentLoaded', () => {

        // ===============================================================
        // FUNÇÃO PARA INICIALIZAR TODA A INTERFACE DO DASHBOARD
        // ===============================================================
        function initializeDashboardUI(user) {
            // Seletores específicos da UI
            const dashboardScreen = document.getElementById('dashboard-screen');
            const welcomeHeader = document.getElementById('welcome-header');
            const appViewScreen = document.getElementById('app-view-screen');
            const darkModeToggle = document.getElementById('dark-mode-toggle');
            const sunIcon = document.getElementById('sun-icon');
            const moonIcon = document.getElementById('moon-icon');
            const insigneAppGrid = document.getElementById('insigne-app-grid');
            const externalAppGrid = document.getElementById('external-app-grid');
            const appIframe = document.getElementById('app-iframe');
            const homeButton = document.getElementById('home-button');
            const logoutButton = document.getElementById('logout-button');
            const footerYear = document.getElementById('footer-year');
            const settingsButton = document.getElementById('settings-button');
            const settingsDropdown = document.getElementById('settings-dropdown');
            const preloader = document.getElementById('preloader');
            const appContentLoader = document.getElementById('app-content-loader');
            const externalLinkModal = document.getElementById('external-link-modal');
            const modalCloseButton = document.getElementById('modal-close-button');
            const modalOpenLink = document.getElementById('modal-open-link');
            const fullscreenToggle = document.getElementById('fullscreen-toggle');
            const expandIcon = document.getElementById('expand-icon');
            const compressIcon = document.getElementById('compress-icon');

            // DADOS DOS APLICATIVOS
            const apps = [
                { type: 'internal', name: 'Notify', url: '/sso/switch?to=001', description: 'Gerencie e dispare todas as suas notificações e alertas inteligentes para os usuários.', icon: `<div class="bg-gray-200 dark:bg-brand-dark-blue p-3 rounded-lg"><svg class="h-6 w-6 text-brand-slate-gray dark:text-gray-200" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 0 0 5.454-1.31A8.967 8.967 0 0 1 18 9.75V9A6 6 0 0 0 6 9v.75a8.967 8.967 0 0 1-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 0 1-5.714 0m5.714 0a3 3 0 1 1-5.714 0" /></svg></div>`},
                { type: 'internal', name: 'Metrics', url: '/sso/redirect?app=metrics', description: 'Acesse todas as métricas e analise o desempenho completo da sua operação.', icon: `<div class="bg-gray-200 dark:bg-brand-dark-blue p-3 rounded-lg"><svg class="h-6 w-6 text-brand-slate-gray dark:text-gray-200" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 3v11.25A2.25 2.25 0 0 0 6 16.5h2.25M3.75 3h-1.5m1.5 0h16.5m0 0h1.5m-1.5 0v11.25A2.25 2.25 0 0 1 18 16.5h-2.25m-7.5 0h7.5m-7.5 0-1 3m8.5-3 1 3m0 0 .5 1.5m-.5-1.5h-9.5m0 0-.5 1.5M9 11.25v1.5M12 9v3.75m3-6v6" /></svg></div>`},
                { type: 'internal', name: 'Drive', url: '/sso/redirect?app=drive', description: 'Armazene e compartilhe todos os arquivos importantes da sua empresa com segurança.', icon: `<div class="bg-gray-200 dark:bg-brand-dark-blue p-3 rounded-lg"><svg class="h-6 w-6 text-brand-slate-gray dark:text-gray-200" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12.75V12A2.25 2.25 0 0 1 4.5 9.75h15A2.25 2.25 0 0 1 21.75 12v.75m-8.69-6.44-2.12-2.12a1.5 1.5 0 0 0-1.061-.44H4.5A2.25 2.25 0 0 0 2.25 6v12a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9a2.25 2.25 0 0 0-2.25-2.25h-5.379a1.5 1.5 0 0 1-1.06-.44Z" /></svg></div>`},
                { type: 'internal', name: 'Amplify', url: '/sso/redirect?app=amplify', description: 'Utilize nossas ferramentas de divulgação para disparar notificações e crescer sua base.', icon: `<div class="bg-gray-200 dark:bg-brand-dark-blue p-3 rounded-lg"><svg class="h-6 w-6 text-brand-slate-gray dark:text-gray-200" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M10.34 1.87a.75.75 0 0 1 .62 0l8.25 4.5a.75.75 0 0 1 0 1.26l-8.25 4.5a.75.75 0 0 1-.62 0l-8.25-4.5a.75.75 0 0 1 0-1.26l8.25-4.5Z" /><path stroke-linecap="round" stroke-linejoin="round" d="M10.34 6.37a.75.75 0 0 1 .62 0l8.25 4.5a.75.75 0 0 1 0 1.26l-8.25 4.5a.75.75 0 0 1-.62 0l-8.25-4.5a.75.75 0 0 1 0-1.26l8.25-4.5Z" /><path stroke-linecap="round" stroke-linejoin="round" d="M10.34 10.87a.75.75 0 0 1 .62 0l8.25 4.5a.75.75 0 0 1 0 1.26l-8.25 4.5a.75.75 0 0 1-.62 0l-8.25-4.5a.75.75 0 0 1 0-1.26l8.25-4.5Z" /></svg></div>`},
                { type: 'internal', name: 'Draft', url: '/sso/redirect?app=draft', description: 'Facilite a escrita de blogs, revisão de contratos e documentos, além de chat com IA.', icon: `<div class="bg-gray-200 dark:bg-brand-dark-blue p-3 rounded-lg"><svg class="h-6 w-6 text-brand-slate-gray dark:text-gray-200" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" /></svg></div>`},
                { type: 'external', name: 'Asaas', url: 'https://www.asaas.com/login', description: 'Plataforma para faturamento', opensInNewTab: true, icon: `<div class="bg-indigo-100 dark:bg-indigo-900/50 p-2 rounded-lg"><svg class="h-5 w-5 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 18.75a60.07 60.07 0 0 1 15.797 2.101c.727.198 1.453-.342 1.453-1.096V18.75M3.75 4.5v.75A.75.75 0 0 1 3 6h-.75m0 0v-.375c0-.621.504-1.125 1.125-1.125H20.25M2.25 6v9m18-10.5v.75c0 .414.336.75.75.75h.75m-1.5-1.5h.375c.621 0 1.125.504 1.125 1.125v9.75c0 .621-.504 1.125-1.125 1.125h-.375m1.5-1.5H21a.75.75 0 0 0-.75.75v.75m0 0H3.75m0 0h-.375a1.125 1.125 0 0 1-1.125-1.125V6.375c0-.621.504-1.125 1.125-1.125h.375m18 0h-4.5M3.75 18h4.5" /></svg></div>`},
                { type: 'external', name: 'Zoho Workplace', url: 'https://workplace.zoho.com', description: 'Suite de colaboração e e-mails', opensInNewTab: true, icon: `<div class="bg-orange-100 dark:bg-orange-900/50 p-2 rounded-lg"><svg class="h-5 w-5 text-orange-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 0 1-2.25 2.25h-15a2.25 2.25 0 0 1-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25m19.5 0v.243a2.25 2.25 0 0 1-1.07 1.916l-7.5 4.615a2.25 2.25 0 0 1-2.36 0L3.32 8.91a2.25 2.25 0 0 1-1.07-1.916V6.75" /></svg></div>`},
                { type: 'external', name: 'Concord CRM', url: 'https://concordcrm.com', description: 'Gerenciamento de clientes', icon: `<div class="bg-teal-100 dark:bg-teal-900/50 p-2 rounded-lg"><svg class="h-5 w-5 text-teal-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M7.5 8.25h9m-9 3H12m-2.25 3h5.25M5.25 5.25h13.5a2.25 2.25 0 0 1 2.25 2.25v10.5a2.25 2.25 0 0 1-2.25 2.25H5.25a2.25 2.25 0 0 1-2.25-2.25V7.5a2.25 2.25 0 0 1 2.25-2.25Z" /></svg></div>`},
                { type: 'external', name: 'Conta Azul', url: 'https://login.contaazul.com', description: 'Plataforma de gestão financeira', icon: `<div class="bg-sky-100 dark:bg-sky-900/50 p-2 rounded-lg"><svg class="h-5 w-5 text-sky-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v12m-3-2.818.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.826-1.106-2.17 0-2.996C10.544 7.72 11.27 7.5 12 7.5c.768 0 1.536.219 2.164.659 1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C17.464 4.219 16.232 4.5 15 4.5c-1.757 0-3.447.44-4.848 1.25-1.49.81-2.652 2.17-2.652 3.75 0 1.58.953 2.94 2.452 3.75C10.456 13.78 11.228 14 12 14c.777 0 1.554-.22 2.19-.659 1.171-.879 3.07.879 4.242 0 1.172.879 1.172-2.303 0-3.182C17.464 9.219 16.232 9.5 15 9.5c-1.757 0-3.447.44-4.848 1.25" /></svg></div>`},
            ];
            const emojis = ['🎉', '🚀', '✨', '💡', '👋', '🔥'];

            // FUNÇÕES DE LÓGICA
            const doLogout = () => {
                localStorage.removeItem('authToken');
                localStorage.removeItem('userInfo');
                window.location.replace('index.html');
            };
            const showPreloader = () => {
                if(preloader) {
                    preloader.classList.remove('hidden');
                    setTimeout(() => preloader.classList.add('opacity-100'), 10);
                }
            };
            const hidePreloader = () => {
                if(preloader) {
                    preloader.classList.remove('opacity-100');
                    setTimeout(() => preloader.classList.add('hidden'), 300);
                }
            };
            const showDashboardScreen = () => {
                dashboardScreen.style.display = 'flex';
                appViewScreen.style.display = 'none';
            };
            const showAppViewScreen = () => {
                dashboardScreen.style.display = 'none';
                appViewScreen.style.display = 'flex';
            };
            const showExternalLinkModal = (appName, url) => {
                if(modalOpenLink) modalOpenLink.href = url;
                if(externalLinkModal) {
                    externalLinkModal.classList.remove('hidden');
                    setTimeout(() => {
                        externalLinkModal.classList.add('opacity-100');
                        externalLinkModal.querySelector('div').classList.remove('scale-95');
                    }, 10);
                }
            };
            const hideExternalLinkModal = () => {
                if(externalLinkModal) {
                    externalLinkModal.classList.remove('opacity-100');
                    externalLinkModal.querySelector('div').classList.add('scale-95');
                    setTimeout(() => {
                        externalLinkModal.classList.add('hidden');
                    }, 300);
                }
            };
            const applyDarkMode = (isDark) => {
                document.documentElement.classList.toggle('dark', isDark);
                if(sunIcon) sunIcon.style.display = isDark ? 'none' : 'block';
                if(moonIcon) moonIcon.style.display = isDark ? 'block' : 'none';
                if(darkModeToggle) darkModeToggle.setAttribute('title', isDark ? 'Alternar para modo claro (Ctrl+I)' : 'Alternar para modo escuro (Ctrl+I)');
            };
            const toggleDarkMode = () => {
                const isDark = !document.documentElement.classList.contains('dark');
                localStorage.setItem('darkMode', isDark ? 'enabled' : 'disabled');
                applyDarkMode(isDark);
            };
            const toggleFullScreen = () => {
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen().catch(err => {
                        console.error(`Erro ao tentar ativar o modo de tela cheia: ${err.message} (${err.name})`);
                    });
                } else {
                    if (document.exitFullscreen) {
                        document.exitFullscreen();
                    }
                }
            };
            const updateFullscreenIcons = () => {
                const isFullscreen = !!document.fullscreenElement;
                if(expandIcon) expandIcon.classList.toggle('hidden', isFullscreen);
                if(compressIcon) compressIcon.classList.toggle('hidden', !isFullscreen);
            };
            const populateAppGrids = () => {
                if(!insigneAppGrid || !externalAppGrid) return;
                insigneAppGrid.innerHTML = '';
                externalAppGrid.innerHTML = '';
                apps.forEach(app => {
                    const card = document.createElement('div');
                    if (app.type === 'internal') {
                        card.className = 'bg-white dark:bg-gray-800 p-6 rounded-xl border border-gray-200 dark:border-gray-700 cursor-pointer transition-all-fast hover:shadow-xl hover:border-brand-dark-blue hover:-translate-y-1 flex flex-col items-start';
                        card.innerHTML = `<div class="flex-shrink-0">${app.icon}</div><h3 class="text-lg font-bold text-gray-900 dark:text-white mt-4">${app.name}</h3><p class="mt-1 text-sm text-gray-500 dark:text-gray-400 flex-grow">${app.description}</p>`;
                        insigneAppGrid.appendChild(card);
                    } else {
                        card.className = 'bg-white dark:bg-gray-800 p-4 rounded-xl border border-gray-200 dark:border-gray-700 cursor-pointer transition-all-fast hover:shadow-lg hover:border-brand-dark-blue hover:-translate-y-1';
                        card.innerHTML = `<div class="flex items-start space-x-3">${app.icon}<div class="flex-1"><h3 class="text-sm font-bold text-gray-900 dark:text-white">${app.name}</h3><p class="mt-1 text-xs text-gray-500 dark:text-gray-400">${app.description}</p></div></div>`;
                        externalAppGrid.appendChild(card);
                    }
                    
                    // =======================================================
                    // CORREÇÃO SSO: Lógica de clique interceptada
                    // =======================================================
                    card.addEventListener('click', async () => {
                        const token = localStorage.getItem('authToken');
                        if (!token) return doLogout(); // Segurança extra

                        if (app.type === 'internal') {
                            try {
                                const response = await fetch(app.url, { // app.url é '/sso/redirect?app=...'
                                    method: 'GET',
                                    headers: {
                                        'Authorization': `Bearer ${token}`
                                    }
                                });

                                if (response.ok) {
                                    const data = await response.json();
                                    if (data.redirectUrl) {
                                        // Abre no iframe
                                        showAppViewScreen();
                                        if(appContentLoader) appContentLoader.classList.remove('hidden');
                                        if(appIframe) appIframe.classList.add('hidden');
                                        if(appIframe) appIframe.src = data.redirectUrl;
                                        setTimeout(() => {
                                            if(appContentLoader) appContentLoader.classList.add('hidden');
                                            if(appIframe) appIframe.classList.remove('hidden');
                                        }, 1000);
                                    }
                                } else {
                                    alert('Falha na autenticação SSO. Tente fazer login novamente.');
                                    doLogout();
                                }
                            } catch (error) {
                                console.error('Erro no processo de SSO:', error);
                                alert('Não foi possível conectar à aplicação.');
                            }
                        } else if (app.opensInNewTab) {
                            showExternalLinkModal(app.name, app.url);
                        }
                    });
                });
            };
            const setWelcomeEmoji = () => {
                const welcomeEmojiSpan = document.getElementById('welcome-emoji');
                if(welcomeEmojiSpan) {
                    const randomIndex = Math.floor(Math.random() * emojis.length);
                    welcomeEmojiSpan.textContent = emojis[randomIndex];
                }
            };
            const setFooterYear = () => {
                if(footerYear) {
                    const year = new Date().getFullYear();
                    footerYear.textContent = `© ${year} Laissez Faire. Todos os direitos reservados.`;
                }
            };

            // INICIALIZAÇÃO E EVENT LISTENERS
            (function init() {
                if(welcomeHeader) {
                    welcomeHeader.innerHTML = `Bem-vindo, ${user.name || 'Usuário'} <span id="welcome-emoji"></span>`;
                }
                if(dashboardScreen) {
                    dashboardScreen.classList.remove('hidden');
                    dashboardScreen.style.display = 'flex';
                }

                const darkModeSaved = localStorage.getItem('darkMode');
                applyDarkMode(darkModeSaved === 'enabled' || (darkModeSaved === null && window.matchMedia('(prefers-color-scheme: dark)').matches));

                populateAppGrids();
                setWelcomeEmoji();
                setFooterYear();
                updateFullscreenIcons();

                if(homeButton) homeButton.addEventListener('click', () => { showPreloader(); setTimeout(() => { showDashboardScreen(); hidePreloader(); }, 500); });
                if(darkModeToggle) darkModeToggle.addEventListener('click', toggleDarkMode);
                if(fullscreenToggle) fullscreenToggle.addEventListener('click', toggleFullScreen);
                document.addEventListener('fullscreenchange', updateFullscreenIcons);
                if(modalCloseButton) modalCloseButton.addEventListener('click', hideExternalLinkModal);
                if(modalOpenLink) modalOpenLink.addEventListener('click', hideExternalLinkModal);
                if(settingsButton) settingsButton.addEventListener('click', (event) => { event.stopPropagation(); if(settingsDropdown) settingsDropdown.classList.toggle('hidden'); });
                document.addEventListener('click', (event) => { if (settingsDropdown && !settingsDropdown.classList.contains('hidden') && settingsButton && !settingsButton.contains(event.target)) { settingsDropdown.classList.add('hidden'); } });
                document.addEventListener('keydown', (e) => { if (e.ctrlKey && e.key.toLowerCase() === 'i') { e.preventDefault(); toggleDarkMode(); } });
                
                const logoutButtonMain = document.querySelector('#settings-dropdown a[href="#pdf"]');
                if(logoutButton) logoutButton.addEventListener('click', doLogout);
            })();
        }

        // =======================================================
        // PONTO DE ENTRADA PRINCIPAL - AUTENTICAÇÃO
        // =======================================================
        (async function authenticateAndLoad() {
            const token = localStorage.getItem('authToken');
            if (!token) {
                alert('Acesso negado. Por favor, faça o login.');
                window.location.replace('index.html');
                return;
            }
            try {
                // CORREÇÃO: Usando URL relativa, removendo a dependência da API_BASE_URL
                const response = await fetch('/api/dashboard', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    }
                });
                if (response.ok) {
                    const data = await response.json();
                    initializeDashboardUI(data.user);
                } else {
                    localStorage.removeItem('authToken');
                    localStorage.removeItem('userInfo');
                    alert('Sua sessão expirou. Por favor, faça o login novamente.');
                    window.location.replace('index.html');
                }
            } catch (error) {
                console.error('Erro ao buscar dados do dashboard:', error);
                alert('Não foi possível conectar ao servidor.');
            }
        })();
    });
</script>


</body>
</html>
